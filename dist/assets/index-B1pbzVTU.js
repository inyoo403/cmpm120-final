import{r as e}from"./phaser-UvlxNa5i.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t=e();class s extends t.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class i extends t.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.setPath("assets"),this.load.image("background","background.png")}create(){this.scene.start("MainMenu")}}class a extends Phaser.Scene{constructor(e){super(e),this.debugMode=!1,this.debugGraphics=[],this.isJumping=!1,this.isDying=!1,this.playerAlive=!0,this.isInvulnerable=!1,this.invulnerableTime=2e3,this.respawnDelay=1e3,this.dustPool=[],this.lastDustTime=0,this.dustInterval=100,this.vfxPools=new Map,this.lastFireballTime=0,this.fireballCooldown=500,this.lastWalkSoundTime=0,this.walkSoundCooldown=150,this.lastJumpSoundTime=0,this.jumpSoundCooldown=500}init(){this.player=null,this.cursors=null,this.map=null,this.groundLayer=null,this.landLayer=null,this.enemies=null,this.playerAlive=!0,this.isDying=!1,this.deathTween=null,this.springs=null,this.blocks=null,this.itemBlocks=null,this.coins=null,this.movingPlatforms=null,this.backgrounds=[],this.lastCameraX=0,this.targetBackgroundX=0,this.currentBackgroundX=0,this.vfxPools=new Map,this.registry.has("coins")||this.registry.set("coins",0),this.registry.has("hasKey1")||this.registry.set("hasKey1",!1),this.registry.has("hasKey2")||this.registry.set("hasKey2",!1),this.registry.has("lives")||this.registry.set("lives",5),this.registry.has("collectedCoins")||this.registry.set("collectedCoins",{})}static initializeGameState(e){e.set("lives",5),e.set("coins",0),e.set("score",0),e.set("hasKey1",!1),e.set("hasKey2",!1),e.set("collectedCoins",{})}preloadAssets(){this.load.image("tiles","assets/colored_packed.png"),this.load.image("tiles_transparent","assets/colored-transparent_packed.png"),this.load.image("tiles_pipe","assets/pipe.png"),this.load.atlas("player","assets/player.png","assets/player.json"),this.load.image("npc","assets/npc.png"),this.load.atlas("enemy","assets/enemy.png","assets/enemy.json"),this.load.atlas("object","assets/object.png","assets/object.json"),this.load.atlas("block","assets/block.png","assets/block.json"),this.load.image("bg","assets/bg.png"),this.load.audio("coinSound","assets/coin.wav"),this.load.audio("blockSound","assets/block.ogg"),this.load.audio("walkSound","assets/block.ogg"),this.load.audio("jumpSound","assets/jump.ogg"),this.load.audio("clickSound","assets/click.ogg"),this.load.audio("enemySound","assets/enemy.ogg"),this.load.audio("deathSound","assets/death.ogg"),this.load.audio("bossDeathSound","assets/bossdeath.ogg"),this.load.audio("fireballSound","assets/fireball.wav"),this.load.audio("bossWalkSound","assets/bosswalk.ogg"),this.load.audio("impactSound","assets/impact.wav")}setupGame(e){this.setupBackground(),this.physics.world.gravity.y=800,this.map=this.make.tilemap({key:e});const t=[];try{const e=this.map.addTilesetImage("1-1","tiles");t.push(e)}catch(n){console.warn("[setupGame] 1-1 tileset 없음")}try{const e=this.map.addTilesetImage("1-1transparent","tiles_transparent");t.push(e)}catch(n){console.warn("[setupGame] transparent tileset 없음")}try{const e=this.map.addTilesetImage("pipe","tiles_pipe");t.push(e)}catch(n){console.warn("[setupGame] pipe tileset 없음")}this.groundLayer=this.map.createLayer("ground",t,0,0),this.groundLayer.setCollisionByExclusion([-1]);try{this.landLayer=this.map.createLayer("land",t,0,0),this.landLayer.setCollisionByExclusion([-1]),this.landLayer.forEachTile((e=>{-1!==e.index&&(e.collideDown=!1,e.collideUp=!0,e.collideLeft=!1,e.collideRight=!1)}))}catch(n){console.warn("[setupGame] land 레이어 없음 - 생략됨"),this.landLayer=null}const s=this.map.widthInPixels,i=this.map.heightInPixels;this.physics.world.setBounds(0,0,s,i),this.setupPlayer(),this.setupCamera(s,i),this.setupAnimations(),this.setupControls(),this.setupUI(),this.physics.add.collider(this.player,this.groundLayer),this.landLayer&&this.physics.add.collider(this.player,this.landLayer),this.coins=this.physics.add.group();const a=this.map.getObjectLayer("coin");if(a){const e=this.registry.get("collectedCoins")[this.scene.key]||[];a.objects.forEach((t=>{if(!e.includes(t.id)){const e=this.coins.create(t.x+8,t.y+8,"object","0218.png");e.body.allowGravity=!1,e.body.setSize(8,8),e.setOffset(4,4),e.coinId=t.id}})),this.physics.add.overlap(this.player,this.coins,this.collectCoin,null,this)}this.keys=this.physics.add.group();const o=this.map.getObjectLayer("keys");o&&(o.objects.forEach((e=>{this.keys.create(e.x+8,e.y-8,"items","key.png").body.allowGravity=!1})),this.physics.add.overlap(this.player,this.keys,this.collectKey,null,this))}setupPlayer(){const e=this.map.getObjectLayer("player");if(!e||!e.objects)return void console.error("Player layer not found in map");const t=e.objects.find((e=>"spawn"===e.name));t?this.player?this.player.setPosition(t.x,t.y):(this.player=this.physics.add.sprite(t.x,t.y,"player"),this.player.setBounce(0),this.player.setCollideWorldBounds(!1),this.player.body.setMaxVelocity(150,400),this.player.body.setDragX(750),this.player.setDepth(20)):console.error("Spawn point not found in player layer")}setupCamera(e,t){this.cameras.main.setBounds(0,0,e,t),this.cameras.main.startFollow(this.player,!0,.08,.08),this.cameras.main.setZoom(2)}setupAnimations(){this.anims.exists("walk")||this.anims.create({key:"walk",frames:[{key:"player",frame:"0361.png"},{key:"player",frame:"0362.png"},{key:"player",frame:"0363.png"}],frameRate:12,repeat:-1}),this.anims.exists("idle")||this.anims.create({key:"idle",frames:[{key:"player",frame:"0361.png"}],frameRate:10}),this.anims.exists("jump")||this.anims.create({key:"jump",frames:[{key:"player",frame:"0364.png"}],frameRate:10})}setupCoins(){this.coinText=this.add.text(16,16,"COINS: 0",{fontFamily:"Arial Black",fontSize:"16px",fill:"#fff",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(100)}setupControls(){this.cursors=this.input.keyboard.createCursorKeys(),this.setupDebugControls()}setupDebugControls(){this.input.keyboard.on("keydown-D",(()=>{this.debugMode=!this.debugMode,this.debugMode?this.enableDebugMode():this.disableDebugMode()}))}enableDebugMode(){this.player.body.setAllowGravity(!1),this.physics.world.removeCollider(this.player.body.collider);const e=this.add.graphics();this.groundLayer.renderDebug(e,{tileColor:null,collidingTileColor:new Phaser.Display.Color(243,134,48,128),faceColor:new Phaser.Display.Color(40,39,37,255)}),this.debugGraphics.push(e)}disableDebugMode(){this.player.body.setAllowGravity(!0),this.physics.add.collider(this.player,this.groundLayer),this.physics.add.collider(this.player,this.landLayer),this.debugGraphics.forEach((e=>{e&&e.destroy()})),this.debugGraphics=[]}collectCoin(e,t){t.destroy(),this.sound.play("coinSound",{volume:.1});const s=this.registry.get("collectedCoins");s[this.scene.key]||(s[this.scene.key]=[]),s[this.scene.key].push(t.coinId),this.registry.set("collectedCoins",s);const i=this.registry.get("coins");this.registry.set("coins",i+1)}collectKey(e,t){t.destroy(),this.registry.set("hasKey1",!0)}handlePlayerMovement(){this.debugMode?this.handleDebugMovement():this.playerAlive&&this.handleNormalMovement()}handleDebugMovement(){this.player.setVelocity(0),this.cursors.left.isDown?(this.player.setVelocityX(-300),this.player.flipX=!0,this.player.anims.play("walk",!0)):this.cursors.right.isDown&&(this.player.setVelocityX(300),this.player.flipX=!1,this.player.anims.play("walk",!0)),this.cursors.up.isDown?this.player.setVelocityY(-300):this.cursors.down.isDown&&this.player.setVelocityY(300),this.cursors.left.isDown||this.cursors.right.isDown||this.player.anims.play("idle",!0)}handleNormalMovement(){if(this.isDying)return;if(this.cursors.left.isDown){if(this.player.body.velocity.x>-150?this.player.setAccelerationX(-800):(this.player.setVelocityX(-150),this.player.setAccelerationX(0)),this.player.flipX=!0,this.player.anims.play("walk",!0),this.player.body.onFloor()){const e=this.time.now;e-this.lastWalkSoundTime>this.walkSoundCooldown&&(this.sound.play("walkSound",{volume:.2}),this.lastWalkSoundTime=e);for(let t=0;t<3;t++){const e=Phaser.Math.Between(-2,4),t=Phaser.Math.Between(-2,2);this.playVFX("object","0218.png",this.player.x+6+e,this.player.y+8+t,{scale:.6+.4*Math.random(),alpha:.5+.3*Math.random(),angle:()=>Phaser.Math.Between(-45,45),duration:200+200*Math.random(),scaleEnd:.1,alphaEnd:0,yOffset:Phaser.Math.Between(-8,-4),xOffset:Phaser.Math.Between(2,8)})}}}else if(this.cursors.right.isDown){if(this.player.body.velocity.x<150?this.player.setAccelerationX(800):(this.player.setVelocityX(150),this.player.setAccelerationX(0)),this.player.flipX=!1,this.player.anims.play("walk",!0),this.player.body.onFloor()){const e=this.time.now;e-this.lastWalkSoundTime>this.walkSoundCooldown&&(this.sound.play("walkSound",{volume:.2}),this.lastWalkSoundTime=e);for(let t=0;t<3;t++){const e=Phaser.Math.Between(-4,2),t=Phaser.Math.Between(-2,2);this.playVFX("object","0218.png",this.player.x-6+e,this.player.y+8+t,{scale:.6+.4*Math.random(),alpha:.5+.3*Math.random(),angle:()=>Phaser.Math.Between(-45,45),duration:200+200*Math.random(),scaleEnd:.1,alphaEnd:0,yOffset:Phaser.Math.Between(-8,-4),xOffset:Phaser.Math.Between(-8,-2)})}}}else this.player.setAccelerationX(0),Math.abs(this.player.body.velocity.x)<10&&this.player.setVelocityX(0),this.player.anims.play("idle",!0);const e=this.player.body.onFloor();if(e&&(this.isJumping=!1),this.cursors.space.isDown&&e&&!this.isJumping){this.player.setVelocityY(-330),this.isJumping=!0,this.player.anims.play("jump",!0);const e=this.time.now;e-this.lastJumpSoundTime>this.jumpSoundCooldown&&(this.sound.play("jumpSound",{volume:.3}),this.lastJumpSoundTime=e)}const t=this.player.isOnPlatform&&this.player.currentPlatform&&this.player.currentPlatform.isVertical;e||t||(!this.player.anims.isPlaying||this.player.anims.currentAnim&&"jump"!==this.player.anims.currentAnim.key)&&this.player.anims.play("jump",!0),!this.cursors.space.isDown&&this.player.body.velocity.y<0&&this.player.setVelocityY(.85*this.player.body.velocity.y)}handlePlayerDeath(){if(!this.isDying&&this.playerAlive){this.isDying=!0,this.playerAlive=!1,this.sound.play("deathSound",{volume:.5}),this.player.body.setVelocity(0,0),this.player.body.setAcceleration(0,0),this.player.setVelocity(0,0);const e=this.registry.get("lives");this.registry.set("lives",e-1),e<=1?this.gameOver():(this.deathTween&&this.deathTween.stop(),this.time.delayedCall(100,(()=>{this.player.body.setVelocity(0,-200),this.player.body.setAllowGravity(!1),this.deathTween=this.tweens.add({targets:this.player,angle:180,y:this.player.y-100,duration:700,ease:"Cubic.easeOut",onComplete:()=>{this.tweens.add({targets:this.player,y:this.cameras.main.scrollY+this.cameras.main.height+100,duration:500,ease:"Cubic.easeIn",onComplete:()=>{this.time.delayedCall(this.respawnDelay,(()=>{this.respawnPlayer()}))}})}})})))}}gameOver(){const e=this.scene.get("UI");e&&e.hide&&e.hide(),this.scene.start("GameOver")}respawnPlayer(){const e=this.map.getObjectLayer("player");if(!e||!e.objects)return void console.error("Player layer not found in map");const t=e.objects.find((e=>"spawn"===e.name));t?(this.player.setPosition(t.x+8,t.y),this.player.setVelocity(0,0),this.player.angle=0,this.player.setAlpha(0),this.player.body.setAllowGravity(!0),this.tweens.add({targets:this.player,alpha:1,duration:500,onComplete:()=>{this.isDying=!1,this.playerAlive=!0,this.isInvulnerable=!0,this.time.delayedCall(this.invulnerableTime,(()=>{this.isInvulnerable=!1}))}})):console.error("Spawn point not found in player layer")}update(){if(this.player.y>this.cameras.main.scrollY+this.cameras.main.height&&this.handlePlayerDeath(),this.handlePlayerMovement(),this.debugGraphics.forEach((e=>{e.visible=this.debugMode})),this.backgrounds&&this.backgrounds.length>0){const e=this.cameras.main.scrollX-this.lastCameraX;this.backgrounds.forEach((t=>{t.targetX+=e*t.factorX,t.currentX=this.lerp(t.currentX,t.targetX,.9),t.sprite.tilePositionX=t.currentX})),this.lastCameraX=this.cameras.main.scrollX}}shutdown(){this.deathTween&&(this.deathTween.stop(),this.deathTween.remove(),this.deathTween=null),this.input.keyboard.removeCapture("ONE,TWO,THREE,FOUR"),this.input.keyboard.removeAllListeners("keydown-ONE"),this.input.keyboard.removeAllListeners("keydown-TWO"),this.input.keyboard.removeAllListeners("keydown-THREE"),this.input.keyboard.removeAllListeners("keydown-FOUR"),this.time.removeAllEvents(),this.player&&this.player.anims&&this.player.anims.stop()}setupUI(){this.coinText=this.add.text(16,16,"COINS: 0",{fontFamily:"Arial Black",fontSize:"16px",fill:"#fff",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(100)}setupBackground(){const e=this.scale.width,t=this.scale.height,s=this.add.tileSprite(0,0,2*e,t,"bg").setOrigin(0,0).setScrollFactor(0).setDepth(-3),i=this.add.tileSprite(0,0,2*e,t,"bg").setOrigin(0,0).setScrollFactor(0).setDepth(-2).setTint(14540253),a=this.add.tileSprite(0,0,2*e,t,"bg").setOrigin(0,0).setScrollFactor(0).setDepth(-1).setTint(12303291);this.backgrounds=[{sprite:s,factorX:.01,currentX:0,targetX:0},{sprite:i,factorX:.02,currentX:0,targetX:0},{sprite:a,factorX:.03,currentX:0,targetX:0}]}lerp(e,t,s){return e*(1-s)+t*s}create(){if(this.scene.isActive("UI")){const e=this.scene.get("UI");e&&e.show&&e.show()}else this.scene.launch("UI");this.cursors=this.input.keyboard.createCursorKeys(),this.fireKey=this.input.keyboard.addKey("F"),this.createVFXPool("object","0218.png",10);const e=e=>{for(const t of this.scene.manager.getScenes(!0))t.scene.stop();this.scene.manager.start(e)};this.input.keyboard.addCapture("ONE,TWO,THREE,FOUR"),this.input.keyboard.on("keydown-ONE",(()=>{e("Level1")})),this.input.keyboard.on("keydown-TWO",(()=>{e("Level2")})),this.input.keyboard.on("keydown-THREE",(()=>{e("Level3")})),this.input.keyboard.on("keydown-FOUR",(()=>{e("Level4")}))}createVFXPool(e,t,s=10){const i=[];for(let a=0;a<s;a++){const s=this.add.sprite(0,0,e,t);s.setActive(!1),s.setVisible(!1),i.push(s)}return this.vfxPools.set(e+"_"+t,i),i}playVFX(e,t,s,i,a={}){const o=e+"_"+t;let n=this.vfxPools.get(o);n||(n=this.createVFXPool(e,t));const l=n.find((e=>!e.active));if(!l)return null;const r={scale:.8,alpha:.7,depth:19,angle:0,duration:300,ease:"Power2",scaleEnd:.2,alphaEnd:0,yOffset:-5,xOffset:0,...a};return l.setActive(!0),l.setVisible(!0),l.setPosition(s,i),l.setScale(r.scale),l.setAlpha(r.alpha),l.setDepth(r.depth),l.angle="function"==typeof r.angle?r.angle():r.angle,this.tweens.add({targets:l,alpha:r.alphaEnd,scale:r.scaleEnd,y:l.y+r.yOffset,x:l.x+r.xOffset,duration:r.duration,ease:r.ease,onComplete:()=>{l.setActive(!1),l.setVisible(!1)}}),l}}class o extends t.Scene{constructor(){super("MainMenu")}init(){const e=this.scene.get("UI");e&&e.hide&&e.hide()}create(){this.cameras.main.setBackgroundColor(255),this.add.image(512,384,"background").setAlpha(.5),this.add.text(512,384,"Click to Start",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{a.initializeGameState(this.registry),this.scene.get("UI")&&(this.scene.stop("UI"),this.scene.launch("UI")),this.scene.start("Level1")}))}}class n extends t.Scene{constructor(){super("GameOver")}init(){const e=this.scene.get("UI");e&&e.hide&&e.hide()}create(){this.cameras.main.setBackgroundColor(0);const e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-50,"GAME OVER",{fontFamily:"Arial Black",fontSize:64,color:"#ff0000",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5);e.alpha=0;const t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+50,"Press SPACE to Return to Menu",{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5);t.alpha=0;const s=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+100,"or Click to Return to Menu",{fontFamily:"Arial Black",fontSize:24,color:"#cccccc",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5);s.alpha=0,this.tweens.add({targets:e,alpha:1,duration:1e3,ease:"Power2",onComplete:()=>{this.tweens.add({targets:t,alpha:1,duration:800,ease:"Power2",onComplete:()=>{this.tweens.add({targets:s,alpha:1,duration:800,ease:"Power2"})}})}}),this.spaceKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.spaceKey.on("down",(()=>{this.returnToMenu()})),this.input.once("pointerdown",(()=>{this.returnToMenu()}))}returnToMenu(){a.initializeGameState(this.registry),this.scene.stop("UI"),this.scene.start("UI"),this.scene.start("MainMenu")}}class l extends t.Scene{constructor(){super({key:"UI",active:!0})}create(){this.livesText=this.add.text(16,16,"LIVES: 5",{fontFamily:"Arial Black",fontSize:"24px",fill:"#ff0000",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(100),this.coinText=this.add.text(16,48,"COINS: 0",{fontFamily:"Arial Black",fontSize:"24px",fill:"#fff",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(100),this.key1Text=this.add.text(16,80,"KEY1: NO",{fontFamily:"Arial Black",fontSize:"24px",fill:"#fff",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(100),this.key2Text=this.add.text(16,112,"KEY2: NO",{fontFamily:"Arial Black",fontSize:"24px",fill:"#fff",stroke:"#000",strokeThickness:4}).setScrollFactor(0).setDepth(100),this.uiContainer=this.add.container(0,0),this.uiContainer.add([this.livesText,this.coinText,this.key1Text,this.key2Text]),this.registry.events.on("changedata",this.updateData,this),this.registry.has("lives")||this.registry.set("lives",5),this.registry.has("coins")||this.registry.set("coins",0),this.registry.has("hasKey1")||this.registry.set("hasKey1",!1),this.registry.has("hasKey2")||this.registry.set("hasKey2",!1),this.updateUIDisplay()}showCenterMessage(e,t=2e3){this.centerMessage&&(this.centerMessage.destroy(),this.centerMessageBg&&this.centerMessageBg.destroy());const s=this.cameras.main.width/2,i=this.cameras.main.height/2;this.centerMessageBg=this.add.rectangle(s,i,400,100,0,.7).setScrollFactor(0).setDepth(999),this.centerMessage=this.add.text(s,i,e,{fontFamily:"Arial Black",fontSize:"32px",fill:"#ff0000",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5).setScrollFactor(0).setDepth(1e3),this.time.delayedCall(t,(()=>{this.centerMessage&&(this.centerMessage.destroy(),this.centerMessage=null),this.centerMessageBg&&(this.centerMessageBg.destroy(),this.centerMessageBg=null)}))}updateUIDisplay(){this.livesText&&this.livesText.setText(`LIVES: ${this.registry.get("lives")}`),this.coinText&&this.coinText.setText(`COINS: ${this.registry.get("coins")}`),this.key1Text&&this.key1Text.setText("KEY1: "+(this.registry.get("hasKey1")?"YES":"NO")),this.key2Text&&this.key2Text.setText("KEY2: "+(this.registry.get("hasKey2")?"YES":"NO"))}show(){this.uiContainer&&this.uiContainer.setVisible(!0)}hide(){this.uiContainer&&this.uiContainer.setVisible(!1)}updateData(e,t,s){if(this.uiContainer&&this.uiContainer.visible&&this.livesText&&this.livesText.active)switch(t){case"lives":this.livesText&&this.livesText.active&&this.livesText.setText(`LIVES: ${s}`);break;case"coins":this.coinText&&this.coinText.active&&this.coinText.setText(`COINS: ${s}`);break;case"hasKey1":this.key1Text&&this.key1Text.active&&this.key1Text.setText("KEY1: "+(s?"YES":"NO"));break;case"hasKey2":this.key2Text&&this.key2Text.active&&this.key2Text.setText("KEY2: "+(s?"YES":"NO"))}}shutdown(){this.registry.events.off("changedata",this.updateData,this),this.livesText=null,this.coinText=null,this.key1Text=null,this.key2Text=null,this.uiContainer=null}}class r extends t.Scene{constructor(){super("Game")}create(){this.scene.launch("UI"),this.cameras.main.setBackgroundColor(65280),this.add.image(512,384,"background").setAlpha(.5),this.add.text(512,384,"Make something fun!\nand share it with us:\nsupport@phaser.io",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("GameOver")}))}}class h extends t.Scene{constructor(){super({key:"CreditsScene"}),this.scrollStarted=!1,this.initialDelay=5e3}init(){const e=this.scene.get("UI");e&&e.hide&&e.hide()}create(){this.cameras.main.setBackgroundColor(0),this.createInitialTexts(),this.createStarWarsCredits(),this.setupInput(),this.time.delayedCall(this.initialDelay,(()=>{this.startCreditsScroll()}))}createInitialTexts(){this.congratsText=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-100,"CONGRATULATIONS!",{fontFamily:"Arial Black",fontSize:"48px",color:"#ffff00",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.congratsText.alpha=0,this.clearText=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"You have completed the game!",{fontFamily:"Arial Black",fontSize:"32px",color:"#ffffff",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.clearText.alpha=0,this.menuText=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+100,"Press SPACE or Click to Return to Menu",{fontFamily:"Arial Black",fontSize:"24px",color:"#ffff00",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.menuText.alpha=0,this.tweens.add({targets:[this.congratsText,this.clearText,this.menuText],alpha:1,duration:1e3,ease:"Power2",delay:this.tweens.stagger(500)}),this.time.delayedCall(this.initialDelay,(()=>{this.tweens.add({targets:[this.congratsText,this.clearText,this.menuText],alpha:0,duration:1e3,ease:"Power2"})}))}createStarWarsCredits(){const e=document.querySelector("canvas"),t=e.getBoundingClientRect(),s=document.createElement("div");s.style.cssText=`\n            position: absolute;\n            top: ${t.top}px;\n            left: ${t.left}px;\n            width: ${t.width}px;\n            height: ${t.height}px;\n            display: flex;\n            justify-content: center;\n            perspective: 1000px;\n            overflow: hidden;\n            opacity: 0;\n            pointer-events: none;\n            background: #000;\n        `;const i=document.createElement("div");i.style.cssText="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: 1;\n        ";for(let n=0;n<200;n++){const e=document.createElement("div"),t=3*Math.random()+1,s=.7*Math.random()+.3;e.style.cssText=`\n                position: absolute;\n                width: ${t}px;\n                height: ${t}px;\n                background: white;\n                border-radius: 50%;\n                top: ${100*Math.random()}%;\n                left: ${100*Math.random()}%;\n                opacity: ${s};\n                animation: twinkle ${2*Math.random()+1}s infinite alternate;\n            `,i.appendChild(e)}const a=document.createElement("div");a.style.cssText="\n            position: absolute;\n            width: 100%;\n            color: #ffff00;\n            font-family: 'Arial Black';\n            font-size: 72px;\n            text-align: center;\n            transform-origin: 50% 100%;\n            transform: scale(2.2) rotateX(45deg) translateY(150vh) translateZ(200px);\n            line-height: 3;\n            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7);\n            z-index: 2;\n        ",[{type:"title",text:"GAME CREDITS"},{type:"space",count:3},{type:"header",text:"DEVELOPMENT TEAM"},{type:"content",text:"Game Developer - Inho Yoo"},{type:"content",text:"Level Designer - Inho Yoo"},{type:"content",text:"Map Designer - Inho Yoo"},{type:"space",count:3},{type:"header",text:"GRAPHICS"},{type:"content",text:"Player Sprite - Kenney"},{type:"content",text:"Environment Tiles - Kenney"},{type:"content",text:"Boss Sprite - Kenney"},{type:"space",count:3},{type:"header",text:"SOUND EFFECTS"},{type:"content",text:"coin.wav - Internet"},{type:"content",text:"block.ogg - Kenney"},{type:"content",text:"jump.ogg - Kenney"},{type:"content",text:"enemy.ogg - Kenney"},{type:"content",text:"bossdeath.ogg - Kenney"},{type:"space",count:3},{type:"header",text:"SPECIAL THANKS"},{type:"content",text:"Phaser.js Framework"},{type:"content",text:"Tiled Map Editor"},{type:"content",text:"Professor Whitehead and CMPM120 TAs"},{type:"space",count:3},{type:"title",text:"THANK YOU FOR PLAYING!"}].forEach((e=>{const t=document.createElement("div");"space"===e.type?t.style.height=72*e.count+"px":(t.textContent=e.text,"header"!==e.type&&"title"!==e.type||(t.style.color="#00ffff",t.style.fontSize="title"===e.type?"96px":"84px",t.style.textShadow="0 0 10px #00ffff")),a.appendChild(t)})),s.appendChild(i),s.appendChild(a),e.parentElement.appendChild(s);const o=()=>{const t=e.getBoundingClientRect();s.style.top=`${t.top}px`,s.style.left=`${t.left}px`,s.style.width=`${t.width}px`,s.style.height=`${t.height}px`};window.addEventListener("resize",o),this.creditContainer=s,this.creditsContent=a,this.cleanup=()=>{window.removeEventListener("resize",o)}}startCreditsScroll(){this.scrollStarted||(this.scrollStarted=!0,this.creditContainer.style.opacity="1",this.creditsContent.style.transition="all 240s linear",this.creditsContent.style.transform="scale(2.2) rotateX(45deg) translateY(-3000vh) translateZ(1000px)",setTimeout((()=>{this.returnToMenu()}),241e3))}setupInput(){this.spaceKey=this.input.keyboard.addKey("SPACE"),this.spaceKey.on("down",(()=>{this.returnToMenu()})),this.input.on("pointerdown",(()=>{this.returnToMenu()}))}returnToMenu(){this.cleanup&&this.cleanup(),this.creditContainer&&this.creditContainer.remove(),a.initializeGameState(this.registry),this.scene.stop("UI"),this.scene.start("UI"),this.scene.start("MainMenu")}}const d={type:t.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",scale:{mode:t.Scale.FIT,autoCenter:t.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:300},debug:!1}},scene:[s,i,o,r,class extends a{constructor(){super({key:"Level1"}),this.isTransitioning=!1,this.messageShown=!1}preload(){this.preloadAssets(),this.load.tilemapTiledJSON("map","assets/level1-1.tmj"),this.load.atlas("object","assets/object.png","assets/object.json")}create(){super.create(),this.setupGame("map"),this.scene.isActive("UI")||this.scene.launch("UI"),this.debugGraphics=[],this.input.keyboard.addKey("D").on("down",(()=>{if(this.debugMode){this.npc.body.debugBodyColor=65280,this.npc.body.debugShowBody=!0,this.npc.body.debugShowVelocity=!0;const e=this.add.graphics();e.lineStyle(1,65280),e.strokeRect(this.npc.body.x,this.npc.body.y,this.npc.body.width,this.npc.body.height),this.debugGraphics.push(e)}else this.npc.body.debugShowBody=!1,this.npc.body.debugShowVelocity=!1,this.debugGraphics.forEach((e=>{e&&e.destroy()})),this.debugGraphics=[]})),this.setupNPC(),this.setupEnemies(),this.setupSprings(),this.setupBlocks(),this.setupCollisions(),this.setupDialogSystem(),this.createNextLevelPoint(),this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels)}shutdown(){super.shutdown(),this.eKey&&this.eKey.removeAllListeners(),this.input.keyboard.removeAllListeners("keydown-D"),this.debugGraphics.forEach((e=>{e&&e.destroy()})),this.debugGraphics=[]}setupDialogSystem(){this.isInDialogRange=!1,this.isDialogActive=!1,this.currentDialogIndex=0,this.dialogs=["Use the arrow keys to move, and press the spacebar to jump.","You can see your lives, coins, and the stage keys in the top-left corner.","Hit blocks to collect coins.","Coins are especially important in the final stage, so try to collect as many as you can.","Hitting item blocks will give you keys to unlock the next stage.","Be careful not to fall off moving platforms.","In the final stage, a special ability will be unlocked, press the F key to find out!"],this.eKey=this.input.keyboard.addKey("E"),this.eKey.on("down",(()=>{this.isInDialogRange&&!this.isDialogActive?(this.sound.play("clickSound",{volume:.4}),this.startDialog()):this.isDialogActive&&(this.sound.play("clickSound",{volume:.4}),this.nextDialog())})),this.dialogBox=this.add.container(400,400).setDepth(100);const e=this.add.graphics();e.fillStyle(0,.95),e.lineStyle(4,16776960),e.fillRoundedRect(-200,-60,400,120,10),e.strokeRoundedRect(-200,-60,400,120,10),this.dialogBox.add(e);const t=this.add.graphics();t.fillStyle(0,1),t.fillRoundedRect(-180,-45,60,90,8),this.dialogBox.add(t),this.npcPortrait=this.add.sprite(-150,0,"npc").setScale(.18).setOrigin(.5,.5),this.dialogBox.add(this.npcPortrait),this.dialogText=this.add.text(-110,-50,"",{fontSize:"15px",fontFamily:"Courier New",fill:"#ffffff",wordWrap:{width:270},lineSpacing:3,padding:{top:6,left:0},align:"left",stroke:"#000000",strokeThickness:3}).setOrigin(0,0),this.dialogText.x=Math.round(this.dialogText.x),this.dialogText.y=Math.round(this.dialogText.y),this.dialogBox.add(this.dialogText),this.dialogBox.setVisible(!1),this.dialogBox.setScrollFactor(0)}startDialog(){this.isDialogActive=!0,this.currentDialogIndex=0,this.showDialog(),this.dialogBox.setVisible(!0)}nextDialog(){this.currentDialogIndex++,this.currentDialogIndex>=this.dialogs.length?this.endDialog():this.showDialog()}showDialog(){this.dialogText.setText(this.dialogs[this.currentDialogIndex])}endDialog(){this.isDialogActive=!1,this.dialogBox.setVisible(!1)}setupNPC(){const e=this.map.getObjectLayer("player");if(!e||!e.objects)return void console.error("Player layer not found in map");const t=e.objects.find((e=>"spawn"===e.name));if(!t)return void console.error("Spawn point not found in player layer");this.npc=this.physics.add.sprite(t.x+128,t.y,"npc"),this.npc.setBounce(0),this.npc.setCollideWorldBounds(!0),this.npc.setDepth(2),this.npc.setScale(.25),this.npc.flipX=!0;const s=this.npc.width,i=this.npc.height,a=.25*s,o=.25*i*.9;this.npc.body.setSize(a,o);const n=.75*s/2,l=.75*i;this.npc.body.setOffset(n,l),this.physics.add.collider(this.npc,this.groundLayer),this.ePrompt=this.add.container(this.npc.x,this.npc.y-20),this.ePrompt.setScale(.5);const r=this.add.text(0,0,"E to talk",{fontFamily:"Arial Black",fontSize:"20px",fill:"#ffffff",stroke:"#000000",strokeThickness:4,shadow:{blur:0,stroke:!0,fill:!0}}).setOrigin(.5);this.ePrompt.add(r),this.ePrompt.setDepth(100),this.events.on("update",(()=>{this.ePrompt.setPosition(this.npc.x,this.npc.y-20)})),this.physics.add.overlap(this.player,this.npc,this.handleNPCInteraction,null,this)}handleNPCInteraction(e,t){this.isInDialogRange||(this.isInDialogRange=!0)}setupEnemies(){this.enemies=this.physics.add.group({bounceX:0,bounceY:0});const e=this.map.getObjectLayer("enemyspawn");e&&e.objects&&e.objects.forEach((e=>{const t=this.enemies.create(e.x,e.y-e.height,"enemy","0320.png");t.setBounce(0),t.setCollideWorldBounds(!0),t.moveDirection=-1,t.setVelocityX(50*t.moveDirection),t.isAlive=!0,t.setScale(1),t.body.setSize(14,14),t.body.setDragX(0)})),this.anims.exists("enemy-walk")||this.anims.create({key:"enemy-walk",frames:[{key:"enemy",frame:"0320.png"}],frameRate:8,repeat:-1}),this.physics.add.collider(this.enemies,this.groundLayer,this.handleEnemyCollision,null,this),this.physics.add.collider(this.enemies,this.landLayer,this.handleEnemyCollision,null,this),this.physics.add.collider(this.player,this.enemies,this.handlePlayerEnemyCollision,null,this)}setupSprings(){this.springs=this.physics.add.group({allowGravity:!1,immovable:!0}),this.anims.exists("spring-compress")||this.anims.create({key:"spring-compress",frames:[{key:"object",frame:"0268.png"},{key:"object",frame:"0267.png"},{key:"object",frame:"0266.png"}],frameRate:20,repeat:0}),this.anims.exists("spring-release")||this.anims.create({key:"spring-release",frames:[{key:"object",frame:"0266.png"},{key:"object",frame:"0267.png"},{key:"object",frame:"0268.png"}],frameRate:20,repeat:0});const e=this.map.getObjectLayer("springspawn");e&&e.objects&&e.objects.forEach((e=>{const t=this.springs.create(e.x+8,e.y+8,"object","0268.png");t.setSize(16,8),t.setOffset(0,8),t.isCompressed=!1,t.body.allowGravity=!1,t.setImmovable(!0)}))}setupBlocks(){this.blocks=this.physics.add.group({allowGravity:!1,immovable:!0}),this.itemBlocks=this.physics.add.group({allowGravity:!1,immovable:!0});const e=this.map.getObjectLayer("blockspawn");e&&e.objects&&e.objects.forEach((e=>{let t;const s=e.x,i=e.y;"blcok"===e.name?(t=this.blocks.create(s,i,"block","0742.png"),t.isHit=!1):"itemblock"===e.name&&(t=this.itemBlocks.create(s,i,"block","0072.png"),t.isHit=!1),t&&(t.setOrigin(0,0),t.setSize(12,16),t.setOffset(2,0),t.setDepth(10),t.body.checkCollision.up=!0,t.body.checkCollision.down=!0,t.body.checkCollision.left=!0,t.body.checkCollision.right=!0)}))}setupCollisions(){this.physics.add.collider(this.enemies,this.groundLayer,this.handleEnemyCollision,null,this),this.physics.add.collider(this.enemies,this.landLayer,this.handleEnemyCollision,null,this),this.physics.add.collider(this.player,this.enemies,this.handlePlayerEnemyCollision,null,this),this.physics.add.collider(this.player,this.springs,this.handleSpringCollision,null,this),this.physics.add.collider(this.player,this.blocks,this.handleBlockCollision,null,this),this.physics.add.collider(this.player,this.itemBlocks,this.handleItemBlockCollision,null,this),this.physics.add.collider(this.coins,this.groundLayer),this.physics.add.collider(this.coins,this.landLayer),this.physics.add.collider(this.coins,this.blocks),this.physics.add.collider(this.coins,this.itemBlocks),this.physics.add.overlap(this.player,this.coins,this.collectCoin,null,this)}handleEnemyCollision(e,t){e.isAlive&&(e.body.blocked.left||e.body.touching.left?(e.moveDirection=1,e.setVelocityX(50),e.flipX=!1):(e.body.blocked.right||e.body.touching.right)&&(e.moveDirection=-1,e.setVelocityX(-50),e.flipX=!0),e.body.blocked.down)&&(this.getTileAhead(e)||(e.moveDirection*=-1,e.setVelocityX(50*e.moveDirection),e.flipX=e.moveDirection<0))}getTileAhead(e){const t=e.moveDirection>0?16:-16,s=e.x+t,i=e.y+e.height+2;return this.groundLayer.getTileAtWorldXY(s,i)||this.landLayer.getTileAtWorldXY(s,i)}handlePlayerEnemyCollision(e,t){t.isAlive&&this.playerAlive&&(e.body.bottom<=t.body.top+10?(this.sound.play("enemySound",{volume:.4}),t.isAlive=!1,t.body.enable=!1,t.setTint(16711680),t.setFlipY(!0),e.setVelocityY(-200),this.time.delayedCall(1e3,(()=>{t.destroy()}))):this.debugMode||this.handlePlayerDeath())}handleSpringCollision(e,t){const s=e.body.bottom,i=t.body.top-s;Math.abs(i)<20&&e.body.velocity.y>=0&&(t.isCompressed||(t.isCompressed=!0,t.anims.play("spring-compress"),this.time.delayedCall(50,(()=>{e.setVelocityY(-500),t.anims.play("spring-release"),t.once("animationcomplete",(()=>{t.isCompressed=!1}))}))))}handleBlockCollision(e,t){if(e.body.touching.up&&!t.isHit){t.isHit=!0,this.sound.play("blockSound",{volume:.3}),t.setTexture("block","0742.png").setTint(10066329).setOrigin(0,0);const e=t.y;this.tweens.add({targets:t,y:e-2,duration:50,yoyo:!0,ease:"Power1",onComplete:()=>{t.y=e,t.setOrigin(0,0);const s=this.coins.create(t.x+8,t.y,"object","0218.png");s.setBounceY(.2),s.setVelocityY(-200),s.setGravityY(400),s.setCollideWorldBounds(!0),s.body.setSize(8,8),s.setOffset(4,4)}})}}handleItemBlockCollision(e,t){if(e.body.touching.up&&!t.isHit){t.isHit=!0,this.sound.play("blockSound",{volume:.3}),t.setTexture("block","0023.png").setOrigin(0,0);const e=this.physics.add.sprite(t.x+8,t.y,"object","0219.png");e.setBounceY(.2),e.setVelocityY(-200),e.setGravityY(400),e.setCollideWorldBounds(!0),e.body.setSize(8,8),e.setOffset(4,4),this.physics.add.collider(e,this.groundLayer),this.physics.add.collider(e,this.landLayer),this.physics.add.collider(e,this.blocks),this.physics.add.collider(e,this.itemBlocks),this.physics.add.overlap(this.player,e,this.collectKey,null,this);const s=t.y;this.tweens.add({targets:t,y:s-2,duration:50,yoyo:!0,ease:"Power1",onComplete:()=>{t.y=s,t.setOrigin(0,0)}})}}collectKey(e,t){t.destroy(),this.registry.set("hasKey1",!0)}createNextLevelPoint(){const e=this.map.getObjectLayer("nextlevel");if(!e)return;const t=e.objects.find((e=>"1-2"===e.name));if(t){const e=this.add.rectangle(t.x,t.y,t.width,t.height);this.physics.add.existing(e,!0),this.physics.add.overlap(this.player,e,(()=>{const e=this.registry.get("hasKey1");if(this.cursors.down.isDown&&!this.isTransitioning&&e)this.startLevelTransition();else if(this.cursors.down.isDown&&!e){const e=this.scene.get("UI");e&&e.showCenterMessage("Need Key 1!")}}))}}update(){this.isTransitioning?this.player.y+=.1:(super.update(),this.enemies.children.iterate((e=>{e&&e.isAlive&&e.body.blocked.down&&e.setVelocityX(50*e.moveDirection)})),this.player.x>this.map.widthInPixels-32&&this.registry.get("hasKey")&&this.scene.start("Level2"),this.player.y>this.map.heightInPixels&&this.handlePlayerDeath(),this.player&&(this.handlePlayerMovement(),Phaser.Math.Distance.Between(this.player.x,this.player.y,this.npc.x,this.npc.y)>50&&this.isInDialogRange&&(this.isInDialogRange=!1),this.nextLevelX&&this.registry.get("hasKey")&&this.player.x>=this.nextLevelX&&Phaser.Input.Keyboard.JustDown(this.cursors.down)&&this.startLevelTransition()))}startLevelTransition(){this.isTransitioning=!0,this.player.setDepth(-1),this.player.body.enable=!1,this.player.setVelocityX(0),this.player.setAccelerationX(0),this.player.setGravityY(50),this.time.delayedCall(1e3,(()=>{this.scene.start("Level2")}))}handleNextLevel(e,t){const s=this.registry.get("hasKey1");"1-2"===t.name&&s&&this.cursors.down.isDown&&(this.isTransitioning||(this.isTransitioning=!0,this.startLevelTransition(),this.time.delayedCall(1e3,(()=>{this.scene.start("Level2")}))))}},class extends a{constructor(){super({key:"Level2"})}preload(){this.preloadAssets(),this.load.tilemapTiledJSON("map2","assets/level1-2.tmj"),this.load.atlas("object","assets/object.png","assets/object.json")}init(){super.init(),this.isTransitioning=!1}create(){this.setupGame("map2");const e=this.registry.get("returnToLevel2");e&&(this.player.setPosition(e.x,e.y),this.registry.remove("returnToLevel2")),this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.physics.add.collider(this.player,this.groundLayer),this.physics.add.collider(this.player,this.landLayer),this.movingPlatforms=this.physics.add.group({allowGravity:!1,immovable:!0}),this.setupMovingPlatforms(),this.setupVerticalPlatforms(),this.setupCollisions(),this.createNextLevelPoints()}createPlatform(e,t){const s=this.add.container(e,t);for(let i=0;i<3;i++){const e=this.add.sprite(16*i-24,-8,"block","0121.png");e.setOrigin(0,0),s.add(e)}return this.physics.world.enable(s),s.body.setSize(48,16).setOffset(-24,-8),s.body.setAllowGravity(!1),s.body.setImmovable(!0),s.body.checkCollision.up=!0,s.body.checkCollision.down=!1,s.body.checkCollision.left=!1,s.body.checkCollision.right=!1,this.movingPlatforms.add(s),s}setupMovingPlatforms(){const e=this.map.getObjectLayer("movingland");if(!e)return;const t=e.objects.find((e=>"landmovepoint1"===e.name)),s=e.objects.find((e=>"landmovepoint2"===e.name));if(t&&s){const e=this.createPlatform(t.x,t.y);e.startPoint=t,e.endPoint=s,e.direction=1,e.moveSpeed=.5}}setupVerticalPlatforms(){const e=this.map.getObjectLayer("movinglandup");if(!e)return;const t=e.objects.find((e=>"landmovepointup"===e.name)),s=e.objects.find((e=>"landmovepointdown"===e.name));if(t&&s){const e=this.createPlatform(s.x,s.y);e.startPoint=s,e.endPoint=t,e.direction=1,e.moveSpeed=.5,e.isVertical=!0}}setupCollisions(){this.physics.add.collider(this.player,this.movingPlatforms,((e,t)=>{e.body.velocity.y>=0&&e.body.bottom<=t.y&&t.body.touching.up&&e.body.touching.down&&(e.y=t.y-t.body.height/2-e.height/2,e.body.velocity.y=0,e.isOnPlatform=!0,e.currentPlatform=t,e.lastPlatformX=t.x)})),this.physics.add.collider(this.coins,this.groundLayer),this.physics.add.collider(this.coins,this.landLayer),this.physics.add.overlap(this.player,this.coins,this.collectCoin,null,this)}createNextLevelPoints(){const e=this.map.getObjectLayer("nextlevel");if(!e)return;const t=e.objects.find((e=>"1-3"===e.name));if(t){const e=this.add.rectangle(t.x,t.y,t.width,t.height);this.physics.add.existing(e,!0),this.physics.add.overlap(this.player,e,(()=>{this.cursors.up.isDown&&!this.isTransitioning&&this.startLevelTransition()}))}const s=e.objects.find((e=>"1-4"===e.name));if(s){const e=this.add.rectangle(s.x,s.y,s.width,s.height);this.physics.add.existing(e,!0),this.physics.add.overlap(this.player,e,(()=>{const e=this.registry.get("hasKey2");if(this.cursors.down.isDown&&!this.isTransitioning&&e)this.startLevelTransitionToLevel4();else if(this.cursors.down.isDown&&!e){const e=this.scene.get("UI");e&&e.showCenterMessage("Need Key 2!")}}))}}startLevelTransition(){this.isTransitioning=!0,this.player.body.enable=!1,this.player.setDepth(-1),this.registry.set("returnToLevel3",!0),this.tweens.add({targets:this.player,y:this.player.y-32,alpha:0,duration:1e3,ease:"Sine.easeIn",onComplete:()=>{this.scene.start("Level3")}})}startLevelTransitionToLevel4(){this.isTransitioning=!0,this.player.body.enable=!1,this.player.setDepth(-1),this.registry.set("returnToLevel4",{x:this.player.x,y:this.player.y}),this.tweens.add({targets:this.player,y:this.player.y+32,alpha:0,duration:1e3,ease:"Sine.easeIn",onComplete:()=>{this.scene.start("Level4")}})}update(){if(this.isTransitioning)this.player.y+=1;else{if(super.update(),this.movingPlatforms.children.iterate((e=>{e.startPoint&&e.endPoint&&(e.isVertical?(e.direction>0&&e.y<=e.endPoint.y?e.direction=-1:e.direction<0&&e.y>=e.startPoint.y&&(e.direction=1),e.y-=e.moveSpeed*e.direction,e.x=e.startPoint.x,e.body.velocity.y=-e.moveSpeed*e.direction*60):(e.direction>0&&e.x>=e.endPoint.x?e.direction=-1:e.direction<0&&e.x<=e.startPoint.x&&(e.direction=1),e.x+=e.moveSpeed*e.direction,e.y=e.startPoint.y,e.body.velocity.x=e.moveSpeed*e.direction*60),e.body.updateFromGameObject())})),this.player.isOnPlatform){const e=this.player.currentPlatform;if(e&&this.player.body.bottom<=e.body.bottom+2&&this.player.body.bottom>=e.body.top-2&&Math.abs(this.player.x-e.x)<32){if(this.player.y=e.y-e.body.height/2-this.player.height/2,!e.isVertical){const t=e.x-this.player.lastPlatformX;this.player.x+=t,this.player.lastPlatformX=e.x}}else this.player.isOnPlatform=!1,this.player.currentPlatform=null}this.player&&this.player.y>this.map.heightInPixels&&this.handlePlayerDeath()}}handleNextLevel(e,t){const s=this.registry.get("hasKey2");"1-4"===t.name&&s&&this.cursors.down.isDown&&(this.isTransitioning||(this.isTransitioning=!0,this.startLevelTransition(),this.time.delayedCall(1e3,(()=>{this.scene.start("Level4")}))))}createNextLevelPoint(){const e=this.map.getObjectLayer("nextlevel");e&&(this.nextLevelPoints=this.physics.add.group(),e.objects.forEach((e=>{const t=this.nextLevelPoints.create(e.x+e.width/2,e.y+e.height/2,"nextlevel");t.name=e.name,t.setSize(e.width,e.height),t.body.allowGravity=!1,t.setVisible(!1)})),this.physics.add.overlap(this.player,this.nextLevelPoints,this.handleNextLevel,null,this))}},class extends a{constructor(){super({key:"Level3"})}preload(){this.preloadAssets(),this.load.tilemapTiledJSON("map3","assets/level1-3.tmj"),this.load.atlas("object","assets/object.png","assets/object.json")}init(){super.init(),this.isTransitioning=!1}create(){this.setupGame("map3"),this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels);const e=this.map.getObjectLayer("player").objects.find((e=>"spawn"===e.name)),t=(null==e?void 0:e.x)??0,s=(null==e?void 0:e.y)??0;this.registry.get("returnToLevel3")?(this.registry.remove("returnToLevel3"),this.isTransitioning=!0,this.player.setAlpha(0),this.player.setY(s+32),this.player.setX(t+8),this.player.setDepth(-1),this.player.body.enable=!1,this.tweens.add({targets:this.player,y:s,alpha:1,duration:1e3,ease:"Sine.easeOut",onComplete:()=>{this.player.setDepth(20),this.player.body.enable=!0,this.isTransitioning=!1}})):this.player.setPosition(t+8,s),this.movingPlatforms=this.physics.add.group({allowGravity:!1,immovable:!0}),this.setupVerticalPlatforms(),this.setupCollisions(),this.createKey()}createKey(){const e=this.map.getObjectLayer("key");e&&e.objects.forEach((e=>{if("item"===e.name){const t=this.physics.add.sprite(e.x+8,e.y-8,"object","0573.png");t.setScale(1),t.setBounce(0),t.setCollideWorldBounds(!0),this.physics.add.collider(t,this.groundLayer),this.physics.add.collider(t,this.landLayer),this.physics.add.overlap(this.player,t,(()=>{t.destroy(),this.registry.set("hasKey2",!0)}))}}))}createPlatform(e,t){const s=this.add.container(e,t);for(let i=0;i<3;i++){const e=this.add.sprite(16*i-24,-8,"block","0121.png");e.setOrigin(0,0),s.add(e)}return this.physics.world.enable(s),s.body.setSize(48,16).setOffset(-24,-8),s.body.setAllowGravity(!1),s.body.setImmovable(!0),s.body.checkCollision.up=!0,s.body.checkCollision.down=!1,s.body.checkCollision.left=!1,s.body.checkCollision.right=!1,this.movingPlatforms.add(s),s}setupVerticalPlatforms(){const e=this.map.getObjectLayer("movinglandup");if(!e)return;const t=e.objects.find((e=>"landmovepointup"===e.name)),s=e.objects.find((e=>"landmovepointdown"===e.name));if(t&&s){const e=this.createPlatform(s.x,s.y);e.startPoint=s,e.endPoint=t,e.direction=1,e.moveSpeed=.5,e.isVertical=!0}}setupCollisions(){this.physics.add.collider(this.player,this.movingPlatforms,((e,t)=>{e.body.velocity.y>=0&&e.body.bottom<=t.y&&t.body.touching.up&&e.body.touching.down&&t.isVertical&&(e.y=t.y-t.body.height/2-e.height/2,e.body.velocity.y=0,e.isOnPlatform=!0,e.currentPlatform=t)}))}checkSceneTransition(){const e=this.map.getObjectLayer("player").objects.find((e=>"spawn"===e.name));e&&Phaser.Math.Distance.Between(this.player.x,this.player.y,e.x+8,e.y)<32&&this.cursors.down.isDown&&!this.isTransitioning&&this.startLevelTransition()}startLevelTransition(){this.isTransitioning=!0,this.player.body.enable=!1,this.player.setDepth(-1),this.tweens.add({targets:this.player,y:this.player.y+32,alpha:0,duration:1e3,ease:"Sine.easeIn",onComplete:()=>{this.registry.set("returnToLevel2",{x:1038,y:64}),this.scene.start("Level2")}})}update(){if(!this.isTransitioning){if(super.update(),this.checkSceneTransition(),this.movingPlatforms.children.iterate((e=>{e.startPoint&&e.endPoint&&(e.isVertical&&(e.direction>0&&e.y<=e.endPoint.y?e.direction=-1:e.direction<0&&e.y>=e.startPoint.y&&(e.direction=1),e.y-=e.moveSpeed*e.direction,e.x=e.startPoint.x,e.body.velocity.y=-e.moveSpeed*e.direction*60),e.body.updateFromGameObject())})),this.player.isOnPlatform){const e=this.player.currentPlatform;e&&this.player.body.bottom<=e.body.bottom+2&&this.player.body.bottom>=e.body.top-2&&Math.abs(this.player.x-e.x)<32&&e.isVertical?this.player.y=e.y-e.body.height/2-this.player.height/2:(this.player.isOnPlatform=!1,this.player.currentPlatform=null)}this.player&&this.player.y>this.map.heightInPixels&&this.handlePlayerDeath()}}},class extends a{constructor(){super({key:"Level4"})}preload(){this.preloadAssets(),this.load.tilemapTiledJSON("map4","assets/level1-4.tmj"),this.load.atlas("object","assets/object.png","assets/object.json"),this.load.image("spinner","assets/spinner.png"),this.load.image("alienBlue_stand","assets/alienBlue_stand.png"),this.load.image("alienBlue_walk1","assets/alienBlue_walk1.png"),this.load.image("alienBlue_walk2","assets/alienBlue_walk2.png"),this.load.image("alienBlue_duck","assets/alienBlue_duck.png"),this.load.audio("bossdeath","assets/bossdeath.ogg"),this.load.audio("bosswalk","assets/bosswalk.ogg")}init(){super.init(),this.isTransitioning=!1,this.bossTriggered=!1,this.boss=null,this.bossTrigger=null,this.bossSpawnPoint=null,this.fireballs=null,this.lastFireballTime=0,this.fireballCooldown=500,this.bossHealthContainer=null,this.bossDebugGraphics=null,this.lastBossWalkSoundTime=0,this.bossWalkSoundCooldown=500}create(){var e;super.create(),this.map=this.make.tilemap({key:"map4"}),this.setupGame("map4"),this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels);const t=this.map.getObjectLayer("player"),s=null==(e=null==t?void 0:t.objects)?void 0:e.find((e=>"spawn"===e.name)),i=(null==s?void 0:s.x)??0,a=(null==s?void 0:s.y)??0;this.registry.get("returnToLevel4")?(this.registry.remove("returnToLevel4"),this.isTransitioning=!0,this.player.setAlpha(0),this.player.setY(a-32),this.player.setX(i+8),this.player.setDepth(-1),this.player.body.enable=!1,this.tweens.add({targets:this.player,y:a,alpha:1,duration:1e3,ease:"Sine.easeOut",onComplete:()=>{this.player.setDepth(20),this.player.body.enable=!0,this.isTransitioning=!1}})):this.player.setPosition(i+8,a),this.movingPlatforms=this.physics.add.group({allowGravity:!1,immovable:!0}),this.setupVerticalPlatforms(),this.setupCollisions(),this.setupSnakeTraps(),this.setupBoss(),this.fireKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F),this.fireballs=this.physics.add.group()}createPlatform(e,t){const s=this.add.container(e,t);for(let i=0;i<3;i++){const e=this.add.sprite(16*i-24,-8,"block","0121.png");e.setOrigin(0,0),s.add(e)}return this.physics.world.enable(s),s.body.setSize(48,16).setOffset(-24,-8),s.body.setAllowGravity(!1),s.body.setImmovable(!0),this.movingPlatforms.add(s),s}setupVerticalPlatforms(){const e=this.map.getObjectLayer("movinglandup");if(!e)return;const t=e.objects.find((e=>"landmovepointup"===e.name)),s=e.objects.find((e=>"landmovepointdown"===e.name));if(t&&s){const e=this.createPlatform(s.x,s.y);e.startPoint=s,e.endPoint=t,e.direction=1,e.moveSpeed=.5,e.isVertical=!0}}setupCollisions(){this.physics.add.overlap(this.player,this.coins,this.collectCoin,null,this),this.physics.add.collider(this.player,this.movingPlatforms,((e,t)=>{e.body.velocity.y>=0&&e.body.bottom<=t.y&&t.body.touching.up&&e.body.touching.down&&t.isVertical&&(e.y=t.y-t.body.height/2-e.height/2,e.body.velocity.y=0,e.isOnPlatform=!0,e.currentPlatform=t)}))}setupSnakeTraps(){this.snakeTraps=[];const e=this.map.getObjectLayer("snake");e&&e.objects.forEach((e=>{if(!e.name.startsWith("point"))return;const t=e.x,s=e.y-16,i=360*Math.random(),a=.8+.4*Math.random(),o={pivotX:t,pivotY:s,baseAngle:i,rotationSpeed:2===parseInt(e.name.replace("point",""))?-a:a,links:[]},n=this.physics.add.sprite(t,s,"spinner");n.setOrigin(.5),n.setScale(.25),n.body.setAllowGravity(!1),n.body.setCircle(n.width/4),n.isCenter=!0,n.angle=i,n.rotationSpeed=-a,this.snakeTraps.push(n),o.links.push(n),this.physics.add.overlap(this.player,n,(()=>{this.handlePlayerDeath()}));for(let l=1;l<6;l++){const e=this.physics.add.sprite(0,0,"spinner");e.setOrigin(.5),e.setScale(.25),e.radiusOffset=12*l,e.body.setAllowGravity(!1),e.body.setCircle(e.width/4),this.snakeTraps.push(e),o.links.push(e),this.physics.add.overlap(this.player,e,(()=>{this.handlePlayerDeath()}))}this.snakeTrapGroups||(this.snakeTrapGroups=[]),this.snakeTrapGroups.push(o)}))}setupBoss(){const e=this.map.getObjectLayer("boss");if(!e)return;const t=e.objects.find((e=>"spawn"===e.name));if(!t)return;const s=this.map.getObjectLayer("player");if(!s)return;const i=s.objects.find((e=>"bosspoint"===e.name));i&&(this.bossSpawnPoint=t,this.bossTrigger=this.add.rectangle(i.x+i.width/2,i.y+i.height/2,i.width,i.height),this.physics.add.existing(this.bossTrigger,!0),this.physics.add.overlap(this.player,this.bossTrigger,(()=>{console.log("보스 트리거 영역 진입!",{bossTriggered:this.bossTriggered,bossExists:!!this.boss,playerPosition:{x:this.player.x,y:this.player.y}}),this.bossTriggered||this.boss?console.log("보스 생성 조건 불만족 - 이미 트리거됨 또는 보스 존재"):(console.log("보스 생성 시작!"),this.bossTriggered=!0,this.spawnBoss(this.bossSpawnPoint.x,this.bossSpawnPoint.y),this.bossTrigger.destroy(),console.log("보스 생성 완료 및 트리거 제거"))})))}spawnBoss(e,t){this.boss=this.physics.add.sprite(e,t-200,"alienBlue_stand"),this.boss.setOrigin(.5,1),this.boss.body.setGravityY(300),this.boss.body.setBounce(.2),this.boss.body.setSize(50,92),this.boss.body.setOffset(0,0),this.boss.moveSpeed=150,this.boss.isAttacking=!1,this.boss.attackCooldown=!1,this.boss.maxHealth=100,this.boss.health=this.boss.maxHealth,this.createBossHealthBar(),this.physics.add.overlap(this.boss,this.player,(()=>{console.log("보스와 플레이어 충돌 감지!",{bossPosition:{x:this.boss.x,y:this.boss.y},playerPosition:{x:this.player.x,y:this.player.y},isDying:this.isDying,playerAlive:this.playerAlive,debugMode:this.debugMode}),this.debugMode?console.log("디버그 모드로 인해 사망 처리 스킵됨"):(console.log("handlePlayerDeath 호출됨"),this.handlePlayerDeath())}),null,this),this.physics.add.overlap(this.boss,this.fireballs,((e,t)=>{this.handleFireballHit(e,t)}),null,this),this.createBossAnimations(),this.groundLayer&&this.physics.add.collider(this.boss,this.groundLayer),this.boss.anims.play("boss_idle",!0)}createBossAnimations(){this.anims.exists("boss_idle")||this.anims.create({key:"boss_idle",frames:[{key:"alienBlue_stand"}],frameRate:10,repeat:-1}),this.anims.exists("boss_walk")||this.anims.create({key:"boss_walk",frames:[{key:"alienBlue_walk1"},{key:"alienBlue_walk2"}],frameRate:8,repeat:-1}),this.anims.exists("boss_duck")||this.anims.create({key:"boss_duck",frames:[{key:"alienBlue_duck"}],frameRate:10,repeat:-1})}createBossHealthBar(){this.bossHealthContainer=this.add.container(this.boss.x,this.boss.y-60),this.bossHealthBarBg=this.add.rectangle(0,0,80,8,0),this.bossHealthBarBg.setOrigin(.5,.5),this.bossHealthBar=this.add.rectangle(-38,0,76,4,16711680),this.bossHealthBar.setOrigin(0,.5),this.bossHealthContainer.add([this.bossHealthBarBg,this.bossHealthBar])}updateBossHealthBar(){if(!this.bossHealthContainer||!this.boss)return;this.bossHealthContainer.setPosition(this.boss.x,this.boss.y-60);const e=this.boss.health/this.boss.maxHealth;this.bossHealthBar.width=76*e}handleFireballHit(e,t){t.destroy(),this.boss.health-=10,this.updateBossHealthBar(),this.boss.setTint(16711680),this.time.delayedCall(100,(()=>{this.boss.clearTint()})),this.boss.health<=0&&this.handleBossDefeat()}handleBossDefeat(){if(this.boss&&(this.sound.play("bossDeathSound",{volume:.5}),this.bossHealthContainer&&(this.bossHealthContainer.destroy(),this.bossHealthContainer=null),this.tweens.add({targets:this.boss,alpha:0,y:this.boss.y-50,duration:1e3,ease:"Power2",onComplete:()=>{this.boss.destroy(),this.boss=null,this.cameras.main.fadeOut(2e3,0,0,0),this.time.delayedCall(2e3,(()=>{this.scene.start("CreditsScene")}))}}),this.particles)){const e=this.particles.createEmitter({x:this.boss.x,y:this.boss.y,speed:{min:-200,max:200},angle:{min:0,max:360},scale:{start:.6,end:0},blendMode:"ADD",lifespan:1e3,gravityY:300});this.time.delayedCall(1e3,(()=>{e.stop()}))}}shootFireball(){const e=this.time.now;if(e-this.lastFireballTime<this.fireballCooldown)return;if(this.registry.get("coins")<1)return;this.sound.play("fireballSound",{volume:.4}),this.registry.set("coins",this.registry.get("coins")-1);const t=this.fireballs.create(this.player.x+(this.player.flipX?-20:20),this.player.y,"object","0218.png");t.setScale(.5),t.body.setSize(8,8),t.setVelocityX(this.player.flipX?-400:400),t.setVelocityY(-200),t.setBounce(.6),t.setGravityY(400),t.setFriction(0),t.bounceCount=0,t.setAngularVelocity(this.player.flipX?-360:360),this.time.delayedCall(5e3,(()=>{t.active&&t.destroy()})),this.lastFireballTime=e}handlePlayerDeath(){super.handlePlayerDeath()}respawnPlayer(){this.scene.restart()}startBossAttack(){if(this.boss.isAttacking||this.boss.attackCooldown)return;this.boss.isAttacking=!0,this.boss.setVelocityX(0);const e=this.player.x;this.boss.setVelocityY(-600);for(let t=0;t<4;t++){const e=Phaser.Math.Between(0,360),t=Phaser.Math.Between(2,8),s=Math.cos(e*Math.PI/180)*t,i=Math.sin(e*Math.PI/180)*t;this.playVFX("object","0218.png",this.boss.x+s,this.boss.y-i,{scale:.9+.3*Math.random(),alpha:.7,angle:()=>e,duration:300+100*Math.random(),scaleEnd:.1,alphaEnd:0,yOffset:-6,xOffset:1.5*s,tint:16777215})}this.tweens.add({targets:this.boss,x:e,duration:700,ease:"Linear",onComplete:()=>{this.boss.setVelocityY(800),this.boss.setVelocityX(0),this.boss.anims.play("boss_duck",!0),this.boss.body.setOffset(0,-23)}})}handlePlayerMovement(){this.debugMode?this.handleDebugMovement():this.playerAlive&&(this.handleNormalMovement(),Phaser.Input.Keyboard.JustDown(this.fireKey)&&this.shootFireball())}updateSnakeTraps(){this.snakeTrapGroups&&this.snakeTrapGroups.forEach((e=>{e.baseAngle+=e.rotationSpeed;const t=Phaser.Math.DegToRad(e.baseAngle);e.links.forEach(((s,i)=>{if(0===i)return void(s.angle-=e.rotationSpeed);const a=s.radiusOffset,o=t;s.x=e.pivotX+Math.cos(o)*a,s.y=e.pivotY+Math.sin(o)*a,s.setRotation(o)}))}))}updateBoss(){if(!this.boss||!this.player)return;if(this.boss.isAttacking&&this.boss.body.onFloor()){this.cameras.main.shake(200,.008);const e=this.sound.add("impactSound",{volume:.7});e.play({seek:1}),this.time.delayedCall(3e3,(()=>{e&&e.isPlaying&&e.stop()}));for(let t=0;t<8;t++){const e=45*t+Phaser.Math.Between(-20,20),s=Phaser.Math.Between(5,15),i=Math.cos(e*Math.PI/180)*s,a=Math.sin(e*Math.PI/180)*s;this.playVFX("object","0218.png",this.boss.x+i,this.boss.y+14+a,{scale:1.2+.4*Math.random(),alpha:.8,angle:()=>e,duration:400+200*Math.random(),scaleEnd:.2,alphaEnd:0,yOffset:-10,xOffset:2*i,tint:16777215})}return this.boss.isAttacking=!1,this.boss.attackCooldown=!0,void this.time.delayedCall(2e3,(()=>{this.boss&&!this.boss.isDefeated&&(this.boss.attackCooldown=!1,this.boss.anims.play("boss_idle",!0),this.boss.body.setOffset(-20,0))}))}const e=Phaser.Math.Distance.Between(this.boss.x,this.boss.y,this.player.x,this.player.y);if(!this.boss.isAttacking&&!this.boss.attackCooldown)if(e<=64)this.startBossAttack();else if(e>64){const e=Phaser.Math.Angle.Between(this.boss.x,this.boss.y,this.player.x,this.player.y),t=Math.cos(e)*this.boss.moveSpeed;if(this.boss.setVelocityX(t),this.boss.flipX=t<0,this.boss.anims.play("boss_walk",!0),this.boss.body.setOffset(-20,0),this.boss.body.onFloor()){const e=this.time.now;e-this.lastBossWalkSoundTime>this.bossWalkSoundCooldown&&(this.sound.play("bosswalk",{volume:.3}),this.lastBossWalkSoundTime=e);const s=t<0?1:-1;for(let t=0;t<2;t++){const e=Phaser.Math.Between(-4,4),t=Phaser.Math.Between(-2,2);this.playVFX("object","0218.png",this.boss.x+20*s+e,this.boss.y+14+t,{scale:.8+.4*Math.random(),alpha:.6,angle:()=>Phaser.Math.Between(-30,30),duration:300+200*Math.random(),scaleEnd:.1,alphaEnd:0,yOffset:Phaser.Math.Between(-8,-4),xOffset:s*Phaser.Math.Between(2,6),tint:16777215})}}}this.boss.isDefeated||this.updateBossHealthBar()}update(){this.isTransitioning||(this.handlePlayerMovement(),this.boss&&this.bossTriggered&&!this.boss.isDefeated&&this.updateBoss(),!this.fireKey.isDown||this.boss&&this.boss.isDefeated||this.shootFireball(),this.updateSnakeTraps(),this.player&&this.player.y>this.map.heightInPixels&&this.handlePlayerDeath(),this.boss&&this.boss.isDefeated||this.physics.add.collider(this.fireballs,this.groundLayer,(e=>{e.bounceCount++,e.bounceCount>=3&&e.destroy()})))}},n,l,h]};new t.Game(d);
